# CSV駆動型レビュー生成AIエージェント - 完全要約

## 🎯 プロジェクト概要

### 核心コンセプト
**CSV駆動型AI創作システム** - 4つのCSVファイルを基に、Claude APIが完全にペルソナになりきって自然な日本語口コミを一から創作するシステム

### 最重要原則
❌ **絶対禁止事項**
- スクリプト処理や機械的な置換は一切使用しない
- テンプレート的な文章構成は避ける
- キーワードの羅列や不自然な挿入は禁止

✅ **AI創作指針**
- Claude APIが完全にペルソナになりきって実際の体験として想像する
- 自然な日本語で一人称の体験談として創作する
- キーワードは文脈に完全に溶け込む形で有機的に配置する

## 📋 CSV駆動システム設計

### 4つのCSVファイル構成
1. **basic_rules.csv** - 基本ルール・必須要素・禁止表現
2. **human_patterns.csv** - ペルソナパターン（年齢層・性格・文体）
3. **qa_knowledge.csv** - 品質管理知識・予期せぬ動作防止
4. **success_examples.csv** - 理想的な出力例・学習データ

### 厳密なワード使用ルール（basic_rules.csv準拠）
- **エリア**: 必ず1つ（池袋、池袋西口）
- **業種**: 必ず1つ（バー、SHOGUN BAR、エンタメバー）
- **USP**: 必ず1つ以上、文字数に応じて最大3つ
  - 150-200文字：1つ
  - 201-300文字：2つ  
  - 301-400文字：3つ
- **環境**: 必ず1つ（アクセス抜群、和モダンな内装等）
- **レコメンド**: 文末に必ず1つ（日本酒好きに、二次会に等）
- **サブ要素**: 自由使用、制限なし（品質・自然さ重視）

### 禁止表現の厳格管理
- ふらっと、偶然、たまたま、立ち寄り
- SHOGUN BAR（池袋西口）形式
- 和風照明の主要推し
- 友達と、彼女と等の同伴者言及

## 🏗️ 技術スタック

### フロントエンド
- **Next.js + React + TypeScript**
- **Tailwind CSS** - 日本語フォント対応
- **CSV処理**: Papa Parse（BOM対応、エラーハンドリング）

### バックエンド・デプロイ
- **Netlify Functions** - サーバーレス実行環境
- **Claude API** - Anthropic Claude-3.5-Sonnet
- **Supabase** - データベース（将来拡張用）

### 開発・運用
- **GitHub** - ソースコード管理
- **Netlify** - 自動デプロイ・ホスティング

## 🚀 現状実装状況

### ✅ 完了済み機能

#### 1. プロジェクト基盤
- Next.js プロジェクト構築
- Netlify デプロイ設定
- 環境変数管理
- TypeScript型定義

#### 2. CSVアップロード・処理
- 4つのCSV個別アップロード機能
- ドラッグ&ドロップ対応
- 即時プレビュー表示
- スキーマバリデーション
- BOM対応・エラーハンドリング
- デバッグ機能

#### 3. AI創作システム
- **CSV駆動動的プロンプト生成**
  - 4つのCSVから情報抽出・統合
  - ペルソナ設定（年齢層、性格、文体特徴）
  - 必須要素の厳密管理
  - 禁止表現の回避指示

- **Claude API直接連携**
  - HTTPSリクエストによる直接呼び出し
  - model: claude-3-5-sonnet-20241022
  - temperature: 0.8（創作性重視）
  - 30秒タイムアウト設定

- **品質管理・スコアリング**
  - 文字数チェック（150-400文字理想）
  - 必須要素含有の厳密確認
  - 禁止表現回避確認
  - レコメンド文末配置確認
  - 自然さチェック

#### 4. UI・UX
- **レビュー生成設定**
  - 生成件数スライダー（1-100件）
  - カスタムプロンプト編集
  - 年齢・性別分布設定

- **結果表示・管理**
  - 品質スコア表示・色分け
  - フィルタリング機能
  - success_examples.csv形式でのCSVダウンロード
  - 詳細メタデータ表示

#### 5. 出力形式
- **success_examples.csv準拠**
  - ヘッダー: review,age,gender,companion,word,recommend
  - 各フィールドの適切なマッピング
  - CSV形式での一括ダウンロード

### 🔧 技術的解決済み問題

#### デプロイ・ビルドエラー
- Layoutコンポーネント参照エラー修正
- TypeScript依存関係の本番移行
- autoprefixer CSS関連エラー解決

#### CSV処理エラー
- BOM除去処理実装
- relax_column_count設定
- ヘッダーバリデーション修正

#### API連携問題
- Netlify Functions対応
- 502エラー（TypeScript依存関係）解決
- 純粋JavaScript実装

#### 品質フィルタリング問題
- 全レビューのスコア0問題解決
- 複雑エージェントシステム簡素化
- 実用的な品質評価システム実装

## 📊 パフォーマンス要件

### 目標性能
- **レビュー生成**: 20件を2分以内
- **CSV処理**: 5秒以内
- **UI応答**: 0.5秒以内

### 品質基準
- **品質スコア**: 6.0以上を高品質として出力
- **文字数**: 150-400文字の自然な範囲
- **必須要素**: 100%含有率
- **禁止表現**: 0%使用率

## 🔐 環境変数設定

```
ANTHROPIC_API_KEY=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
SUPABASE_URL=https://vtozksgtcaixghqkndyt.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0b3prc2d0Y2FpeGdocWtuZHl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyNDYwNDYsImV4cCI6MjA2MzgyMjA0Nn0
```

## 🎯 システムの独自性・価値

### 1. 真のAI創作システム
- テンプレート置換ではなく、AIによる完全創作
- ペルソナ完全体現による自然な文章生成
- 人間らしい不完全さを含む高品質出力

### 2. CSV駆動の柔軟性
- ルール変更がCSV編集だけで可能
- 非技術者でも運用・調整可能
- スケーラブルな知識管理

### 3. 厳密な品質管理
- 必須要素の100%含有保証
- 禁止表現の完全回避
- 文末レコメンド配置の確認

## 📝 次回開発時の注意点

### 重要な設計思想
1. **置換は絶対禁止** - AIによる完全創作を維持
2. **CSV駆動** - 全ルールをCSVで管理
3. **自然さ最優先** - 機械的な文章は避ける
4. **厳密なルール遵守** - basic_rules.csvの完全準拠

### 拡張可能性
- 他業種への対応（CSV変更のみ）
- 多言語対応
- より高度なペルソナ設定
- リアルタイム品質調整

## 🚀 デプロイ情報

- **GitHub Repository**: csv-reviewgenerator
- **Netlify URL**: 自動デプロイ設定済み
- **本番環境**: 環境変数設定完了
- **テスト環境**: ローカル開発環境構築済み 